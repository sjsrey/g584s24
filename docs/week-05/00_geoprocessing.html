<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Geographic Information Systems Applications - Geoprocessing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../week-06/inequality.html" rel="next">
<link href="../week-04/0208_choropleths.html" rel="prev">
<link href="../assets/favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="assets/styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../week-05/00_geoprocessing.html">Week 5 2/13 2/15</a></li><li class="breadcrumb-item"><a href="../week-05/00_geoprocessing.html">Geoprocessing</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../assets/logo.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/sjsrey/g584s24" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
    <div id="quarto-search" class="quarto-navigation-tool px-1" title="Search"></div>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Syllabus</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GEOG 584</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Week 2 1/23 1/25</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-02/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Jupyter Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-02/files-dirs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Unix File System with Jupyter Lab</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Week 3 1/30 2/01</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-03/pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-03/0201_pandas_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pandas Part II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-03/0201_geopandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GeoPandas</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Week 4 2/06 2/08</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-04/0206_choropleths.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geovisualization with PySAL I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-04/0208_choropleths.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geovisualization with PySAL II</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Week 5 2/13 2/15</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-05/00_geoprocessing.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Geoprocessing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Week 6 2/20 2/22</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-06/inequality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regional Inequality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-06/spatialinequality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regional Inequality Decomposition</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">Week 7 2/27 2/29</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-07/isochrones.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Isochrones</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-07/spatial_joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Joins, Overlay, and Interpolation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
 <span class="menu-text">Week 8 3/05 3/07</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-08/accessibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Continuous Accessibility Measures</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">
 <span class="menu-text">Week 9 3/12 3/14</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-09/clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Clustering</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">
 <span class="menu-text">Week 10 3/19 3/21</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
 <span class="menu-text">week-10/clustering.ipynb</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../week-10/exercise4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 4: Geodemographic Analysis of Los Angeles</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#geoprocessing" id="toc-geoprocessing" class="nav-link active" data-scroll-target="#geoprocessing">Geoprocessing</a>
  <ul class="collapse">
  <li><a href="#reading-parquet-files" id="toc-reading-parquet-files" class="nav-link" data-scroll-target="#reading-parquet-files">Reading Parquet Files</a></li>
  <li><a href="#reading-shapefiles" id="toc-reading-shapefiles" class="nav-link" data-scroll-target="#reading-shapefiles">Reading shapefiles</a>
  <ul class="collapse">
  <li><a href="#reading-a-point-shapefile" id="toc-reading-a-point-shapefile" class="nav-link" data-scroll-target="#reading-a-point-shapefile">Reading a point shapefile</a></li>
  </ul></li>
  <li><a href="#integrating-spatial-datasets" id="toc-integrating-spatial-datasets" class="nav-link" data-scroll-target="#integrating-spatial-datasets">Integrating spatial datasets</a></li>
  <li><a href="#extracting-riverside-county-tracts" id="toc-extracting-riverside-county-tracts" class="nav-link" data-scroll-target="#extracting-riverside-county-tracts">Extracting Riverside County Tracts</a></li>
  <li><a href="#spatial-joins" id="toc-spatial-joins" class="nav-link" data-scroll-target="#spatial-joins">Spatial Joins</a></li>
  <li><a href="#determine-the-number-of-clinics-in-each-tract" id="toc-determine-the-number-of-clinics-in-each-tract" class="nav-link" data-scroll-target="#determine-the-number-of-clinics-in-each-tract">Determine the number of clinics in each tract</a></li>
  <li><a href="#table-join" id="toc-table-join" class="nav-link" data-scroll-target="#table-join">Table Join</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/sjsrey/g584s24/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../week-05/00_geoprocessing.html">Week 5 2/13 2/15</a></li><li class="breadcrumb-item"><a href="../week-05/00_geoprocessing.html">Geoprocessing</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Geoprocessing</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="cell-1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(<span class="st">"ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="geoprocessing" class="level1">
<h1>Geoprocessing</h1>
<p>Spatial data comes in a rich variety of forms and corresponding file formats. At the beginning of most geocomputational workflows, one is typically reading these different formats and applying different forms of spatial data processing (or geoprocessing) methods to the data.</p>
<p>In this notebook we cover a subset of geoprocessing methods:</p>
<ul>
<li>Reading geopackages and shapefiles</li>
<li>Coordinate reference system transformations</li>
<li>Spatial joins</li>
<li>Spatial aggregations</li>
</ul>
<p>Along the way we introduce the package <a href="https://geopandas.org">geopandas</a> which provides key spatial data processing functionality.</p>
<section id="reading-parquet-files" class="level2">
<h2 class="anchored" data-anchor-id="reading-parquet-files">Reading Parquet Files</h2>
<p>We begin with our first dataset that contains socieconomic data for census tracts in Southern California. The data are for the census year 2010 and are provided from the package <a href="https://github.com/spatialucr/geosnap">GeoSNAP</a> as a <strong>Parquet File</strong>.</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>scag <span class="op">=</span> gpd.read_parquet(<span class="st">"data/scag_region.parquet"</span>) <span class="co"># read the geopackage </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(scag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>geopandas.geodataframe.GeoDataFrame</code></pre>
</div>
</div>
<div id="cell-7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>scag.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>Index(['geoid', 'n_asian_under_15', 'n_black_under_15', 'n_hispanic_under_15',
       'n_native_under_15', 'n_white_under_15', 'n_persons_under_18',
       'n_asian_over_60', 'n_black_over_60', 'n_hispanic_over_60',
       ...
       'year', 'n_total_housing_units_sample', 'p_nonhisp_white_persons',
       'p_white_over_60', 'p_black_over_60', 'p_hispanic_over_60',
       'p_native_over_60', 'p_asian_over_60', 'p_disabled', 'geometry'],
      dtype='object', length=194)</code></pre>
</div>
</div>
<div id="cell-8" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(scag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>geopandas.geodataframe.GeoDataFrame</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>scag.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geoid</th>
<th data-quarto-table-cell-role="th">n_asian_under_15</th>
<th data-quarto-table-cell-role="th">n_black_under_15</th>
<th data-quarto-table-cell-role="th">n_hispanic_under_15</th>
<th data-quarto-table-cell-role="th">n_native_under_15</th>
<th data-quarto-table-cell-role="th">n_white_under_15</th>
<th data-quarto-table-cell-role="th">n_persons_under_18</th>
<th data-quarto-table-cell-role="th">n_asian_over_60</th>
<th data-quarto-table-cell-role="th">n_black_over_60</th>
<th data-quarto-table-cell-role="th">n_hispanic_over_60</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">n_total_housing_units_sample</th>
<th data-quarto-table-cell-role="th">p_nonhisp_white_persons</th>
<th data-quarto-table-cell-role="th">p_white_over_60</th>
<th data-quarto-table-cell-role="th">p_black_over_60</th>
<th data-quarto-table-cell-role="th">p_hispanic_over_60</th>
<th data-quarto-table-cell-role="th">p_native_over_60</th>
<th data-quarto-table-cell-role="th">p_asian_over_60</th>
<th data-quarto-table-cell-role="th">p_disabled</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>06037128702</td>
<td>58.0</td>
<td>0.0</td>
<td>223.0</td>
<td>0.0</td>
<td>475.0</td>
<td>986.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2010</td>
<td>2903.0</td>
<td>64.726214</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((-118.44870 34.16485, -118.43997 34.1...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>06037131600</td>
<td>83.0</td>
<td>62.0</td>
<td>777.0</td>
<td>0.0</td>
<td>135.0</td>
<td>1355.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2010</td>
<td>1487.0</td>
<td>28.679979</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((-118.56229 34.22033, -118.55792 34.2...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>06037134104</td>
<td>287.0</td>
<td>17.0</td>
<td>816.0</td>
<td>0.0</td>
<td>61.0</td>
<td>1323.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2010</td>
<td>1388.0</td>
<td>14.846188</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((-118.57976 34.21558, -118.57539 34.2...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>06037134304</td>
<td>90.0</td>
<td>24.0</td>
<td>298.0</td>
<td>0.0</td>
<td>89.0</td>
<td>520.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2010</td>
<td>928.0</td>
<td>33.378933</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((-118.61472 34.21952, -118.61039 34.2...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>06037242000</td>
<td>0.0</td>
<td>229.0</td>
<td>681.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1164.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2010</td>
<td>1054.0</td>
<td>0.058565</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((-118.25416 33.93882, -118.25413 33.9...</td>
</tr>
</tbody>
</table>

<p>5 rows × 194 columns</p>
</div>
</div>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>scag.shape </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>(4580, 194)</code></pre>
</div>
</div>
<p>This tells us there are 4580 census tracts and 194 attributes measured for each tract.</p>
<div id="cell-12" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>scag.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Index(['geoid', 'n_asian_under_15', 'n_black_under_15', 'n_hispanic_under_15',
       'n_native_under_15', 'n_white_under_15', 'n_persons_under_18',
       'n_asian_over_60', 'n_black_over_60', 'n_hispanic_over_60',
       ...
       'year', 'n_total_housing_units_sample', 'p_nonhisp_white_persons',
       'p_white_over_60', 'p_black_over_60', 'p_hispanic_over_60',
       'p_native_over_60', 'p_asian_over_60', 'p_disabled', 'geometry'],
      dtype='object', length=194)</code></pre>
</div>
</div>
<p>At least one of the attributes (columns) in the GeoDataFrame holds the geometries for the observations. In our case, this column is named <code>geometry</code>:</p>
<div id="cell-14" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>scag.geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>0       POLYGON ((-118.44870 34.16485, -118.43997 34.1...
1       POLYGON ((-118.56229 34.22033, -118.55792 34.2...
2       POLYGON ((-118.57976 34.21558, -118.57539 34.2...
3       POLYGON ((-118.61472 34.21952, -118.61039 34.2...
4       POLYGON ((-118.25416 33.93882, -118.25413 33.9...
                              ...                        
4575    POLYGON ((-118.50373 34.42607, -118.50050 34.4...
4576    POLYGON ((-118.20731 33.90754, -118.20641 33.9...
4577    POLYGON ((-119.22134 34.18130, -119.21727 34.1...
4578    POLYGON ((-116.51068 33.80502, -116.51069 33.8...
4579    POLYGON ((-118.41379 34.17940, -118.41160 34.1...
Name: geometry, Length: 4580, dtype: geometry</code></pre>
</div>
</div>
<p>This shows us that each of our observations is encoded as a Polygon geometry.</p>
<p>We can call the <code>plot</code> method of the GeoDataFrame to visualize these geometries:</p>
<div id="cell-16" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>scag.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_geoprocessing_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note that the tract identifier column is <code>geoid</code> which encodes the <a href="https://www.fcc.gov/general/form-477-census-tract-information">11-digit FIPS code</a>.</p>
</section>
<section id="reading-shapefiles" class="level2">
<h2 class="anchored" data-anchor-id="reading-shapefiles">Reading shapefiles</h2>
<p><a href="https://doc.arcgis.com/en/arcgis-online/reference/shapefiles.htm">shapefiles</a> are a common legacy spatial data format for vector data. Let’s explore a second data set that encodes mental health provider locations in Riverside County, California as points in a shapefile:</p>
<section id="reading-a-point-shapefile" class="level3">
<h3 class="anchored" data-anchor-id="reading-a-point-shapefile">Reading a point shapefile</h3>
<div id="cell-20" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>clinics_df <span class="op">=</span> gpd.read_parquet(<span class="st">'data/behavioralHealth.parquet'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>clinics_df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>Index(['OBJECTID', 'SITE_TYPE', 'SITE_NAME', 'ADDRESS', 'CITY', 'ZIPCODE',
       'PHONE', 'geometry'],
      dtype='object')</code></pre>
</div>
</div>
<div id="cell-21" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>clinics_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">SITE_TYPE</th>
<th data-quarto-table-cell-role="th">SITE_NAME</th>
<th data-quarto-table-cell-role="th">ADDRESS</th>
<th data-quarto-table-cell-role="th">CITY</th>
<th data-quarto-table-cell-role="th">ZIPCODE</th>
<th data-quarto-table-cell-role="th">PHONE</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>149.0</td>
<td>Behavioral Health</td>
<td>Older Adult Services</td>
<td>6355 Riverside Ave</td>
<td>Riverside</td>
<td>92506</td>
<td>951-369-0219</td>
<td>POINT (6216487.156 2291913.664)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>150.0</td>
<td>Behavioral Health</td>
<td>Children'S Treatment Services</td>
<td>9990 County Farm Rd</td>
<td>Riverside</td>
<td>92503</td>
<td>951-358-4840</td>
<td>POINT (6195566.226 2280519.190)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>151.0</td>
<td>Behavioral Health</td>
<td>Family, Adolescent, And Children'S Treatment</td>
<td>1195 Magnolia Ave</td>
<td>Corona</td>
<td>91719</td>
<td>951-273-0608</td>
<td>POINT (6168252.101 2261023.951)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>447.0</td>
<td>Behavioral Health</td>
<td>Blythe Clinic</td>
<td>1297 W Hobson Way</td>
<td>Blythe</td>
<td>92225</td>
<td>760-770-2222</td>
<td>POINT (7059944.605 2169652.046)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>152.0</td>
<td>Behavioral Health</td>
<td>Interagency Services For Families</td>
<td>9890 County Farm Rd</td>
<td>Riverside</td>
<td>92503</td>
<td>951-358-4850</td>
<td>POINT (6195949.672 2280510.302)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>clinics_df.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_geoprocessing_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-23" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>clinics_df.geometry</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>0     POINT (6216487.156 2291913.664)
1     POINT (6195566.226 2280519.190)
2     POINT (6168252.101 2261023.951)
3     POINT (7059944.605 2169652.046)
4     POINT (6195949.672 2280510.302)
5     POINT (6195566.226 2280519.190)
6     POINT (6255240.101 2281392.265)
7     POINT (6162865.861 2269381.489)
8     POINT (6195182.779 2280509.032)
9     POINT (6342387.266 2220024.356)
10    POINT (6195566.226 2280519.190)
11    POINT (6577094.185 2205388.907)
12    POINT (6195566.226 2280519.190)
13    POINT (6283871.161 2136729.378)
14    POINT (6229918.194 2307140.803)
15    POINT (6496477.603 2228753.546)
16    POINT (6342390.651 2220029.434)
17    POINT (6265042.293 2237006.918)
18    POINT (6341877.001 2233915.961)
19    POINT (6283867.341 2136731.288)
20    POINT (6367147.411 2280861.442)
21    POINT (6496480.142 2228757.355)
22    POINT (6570450.368 2198847.190)
23    POINT (6234956.516 2303352.150)
24    POINT (6195566.226 2280520.460)
25    POINT (6216489.695 2291912.394)
26    POINT (6229918.194 2307139.534)
27    POINT (6229920.733 2307139.534)
Name: geometry, dtype: geometry</code></pre>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>clinics_df.ADDRESS</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>0         6355 Riverside Ave
1        9990 County Farm Rd
2          1195 Magnolia Ave
3          1297 W Hobson Way
4        9890 County Farm Rd
5        9990 County Farm Rd
6       23119 Cottonwood Ave
7              623 N Main St
8       10000 County Farm Rd
9             650 N State St
10       9990 County Farm Rd
11             83-912 Ave 45
12       9990 County Farm Rd
13    41002 County Center Dr
14          1827 Atlanta Ave
15           68-615 Perez Rd
16            650 N State St
17        1688 N Perris Blvd
18         950 N Ramona Blvd
19    41002 County Center Dr
20          1330 W Ramsey St
21           68-615 Perez Rd
22           47-825 Oasis St
23             769 Blaine St
24       9990 County Farm Rd
25        6355 Riverside Ave
26          1827 Atlanta Ave
27          1827 Atlanta Ave
Name: ADDRESS, dtype: object</code></pre>
</div>
</div>
<div id="cell-25" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(clinics_df.ADDRESS.unique()) <span class="co"># note some clinics have the same address (different types of services provided at same location)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>18</code></pre>
</div>
</div>
</section>
</section>
<section id="integrating-spatial-datasets" class="level2">
<h2 class="anchored" data-anchor-id="integrating-spatial-datasets">Integrating spatial datasets</h2>
<p>Let’s assume the role of a public health epidemiologist who is interested in equity issues surrounding access to mental health services. We have two datasets to work with here:</p>
<ul>
<li>the clinics (points in Riverside County)</li>
<li>the tracts for all of Southern California</li>
</ul>
<p>We will thus want to narrow down the focus to Riverside county. So first, we need to extract the tracts for the county from the larger region:</p>
</section>
<section id="extracting-riverside-county-tracts" class="level2">
<h2 class="anchored" data-anchor-id="extracting-riverside-county-tracts">Extracting Riverside County Tracts</h2>
<div id="cell-28" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>rc <span class="op">=</span> scag[scag[<span class="st">'geoid'</span>].<span class="bu">str</span>.match(<span class="st">"^06065"</span>)]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>rc.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_geoprocessing_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spatial-joins" class="level2">
<h2 class="anchored" data-anchor-id="spatial-joins">Spatial Joins</h2>
<p>With the two datasets in hand, we would like to know the answer to the following question:</p>
<blockquote class="blockquote">
<p>How many clinics are in each census tract in Riverside County?</p>
</blockquote>
<p>To get at this answer will can use a <a href="https://gisgeography.com/spatial-join/">spatial join</a>. The idea here is to create a linkage between each clinic (point) and the tract (polygon) that the clinic lies within.</p>
<p>The answer to our question will be the number of matches found for each census tract.</p>
<p>In geopandas the spatial join is done with the <code>sjoin</code> method of the GeoDataFrame:</p>
<div id="cell-30" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>clinics_tracts <span class="op">=</span> gpd.sjoin(clinics_df, rc, op<span class="op">=</span><span class="st">'within'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We see a warning here, that alerts us to a mismatch between the CRS: <a href="https://www.w3.org/2015/spatial/wiki/Coordinate_Reference_Systems">Coordinate Reference Systems</a> of the two GeoDataFrames. We can inspect these to see what is going on:</p>
<div id="cell-32" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>clinics_df.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>&lt;Projected CRS: EPSG:2230&gt;
Name: NAD83 / California zone 6 (ftUS)
Axis Info [cartesian]:
- X[east]: Easting (US survey foot)
- Y[north]: Northing (US survey foot)
Area of Use:
- name: United States (USA) - California - counties Imperial; Orange; Riverside; San Diego.
- bounds: (-118.15, 32.53, -114.42, 34.08)
Coordinate Operation:
- name: SPCS83 California zone 6 (US Survey feet)
- method: Lambert Conic Conformal (2SP)
Datum: North American Datum 1983
- Ellipsoid: GRS 1980
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>rc.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<p>So the clinics have a unit of feet, while the tracts are in degrees. The spatial join will be incorrect because of this since the observations from the two dataframes are in different coordinate systems:</p>
<div id="cell-35" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>clinics_tracts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">SITE_TYPE</th>
<th data-quarto-table-cell-role="th">SITE_NAME</th>
<th data-quarto-table-cell-role="th">ADDRESS</th>
<th data-quarto-table-cell-role="th">CITY</th>
<th data-quarto-table-cell-role="th">ZIPCODE</th>
<th data-quarto-table-cell-role="th">PHONE</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_right</th>
<th data-quarto-table-cell-role="th">geoid</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">n_white_persons</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">n_total_housing_units_sample</th>
<th data-quarto-table-cell-role="th">p_nonhisp_white_persons</th>
<th data-quarto-table-cell-role="th">p_white_over_60</th>
<th data-quarto-table-cell-role="th">p_black_over_60</th>
<th data-quarto-table-cell-role="th">p_hispanic_over_60</th>
<th data-quarto-table-cell-role="th">p_native_over_60</th>
<th data-quarto-table-cell-role="th">p_asian_over_60</th>
<th data-quarto-table-cell-role="th">p_disabled</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

<p>0 rows × 202 columns</p>
</div>
</div>
</div>
</div>
<p>To rectify this, we need to have both GeoDataFrames in the same CRS. Let’s change the CRS of the tracts GeoDataFrame which is currently:</p>
<div id="cell-37" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>rc.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_geoprocessing_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>To change this, we notice the helpful suggestion in the warning above to use the <code>to_crs</code> method. Let’s try it to see how this works:</p>
<div id="cell-39" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>rc.to_crs(clinics_df.crs).plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="00_geoprocessing_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Comparison of the two plots shows us that the CRS has been changed. We did not assign the object yet (which is good practice when experimenting). But it does what we need, so lets assign the result to redefine our tracts GeoDataFrame:</p>
<div id="cell-41" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>rc <span class="op">=</span> rc.to_crs(clinics_df.crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>clinics_tracts <span class="op">=</span> gpd.sjoin(clinics_df, rc, op<span class="op">=</span><span class="st">'within'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-43" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>clinics_tracts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">SITE_TYPE</th>
<th data-quarto-table-cell-role="th">SITE_NAME</th>
<th data-quarto-table-cell-role="th">ADDRESS</th>
<th data-quarto-table-cell-role="th">CITY</th>
<th data-quarto-table-cell-role="th">ZIPCODE</th>
<th data-quarto-table-cell-role="th">PHONE</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_right</th>
<th data-quarto-table-cell-role="th">geoid</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">n_white_persons</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">n_total_housing_units_sample</th>
<th data-quarto-table-cell-role="th">p_nonhisp_white_persons</th>
<th data-quarto-table-cell-role="th">p_white_over_60</th>
<th data-quarto-table-cell-role="th">p_black_over_60</th>
<th data-quarto-table-cell-role="th">p_hispanic_over_60</th>
<th data-quarto-table-cell-role="th">p_native_over_60</th>
<th data-quarto-table-cell-role="th">p_asian_over_60</th>
<th data-quarto-table-cell-role="th">p_disabled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>149.0</td>
<td>Behavioral Health</td>
<td>Older Adult Services</td>
<td>6355 Riverside Ave</td>
<td>Riverside</td>
<td>92506</td>
<td>951-369-0219</td>
<td>POINT (6216487.156 2291913.664)</td>
<td>661</td>
<td>06065031100</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1715.0</td>
<td>49.159311</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>146.0</td>
<td>Behavioral Health</td>
<td>Adult Mental Health Services - Central Clinic</td>
<td>6355 Riverside Ave</td>
<td>Riverside</td>
<td>92506</td>
<td>951-369-5714</td>
<td>POINT (6216489.695 2291912.394)</td>
<td>661</td>
<td>06065031100</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1715.0</td>
<td>49.159311</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>150.0</td>
<td>Behavioral Health</td>
<td>Children'S Treatment Services</td>
<td>9990 County Farm Rd</td>
<td>Riverside</td>
<td>92503</td>
<td>951-358-4840</td>
<td>POINT (6195566.226 2280519.190)</td>
<td>1798</td>
<td>06065041201</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1135.0</td>
<td>25.836431</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>152.0</td>
<td>Behavioral Health</td>
<td>Interagency Services For Families</td>
<td>9890 County Farm Rd</td>
<td>Riverside</td>
<td>92503</td>
<td>951-358-4850</td>
<td>POINT (6195949.672 2280510.302)</td>
<td>1798</td>
<td>06065041201</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1135.0</td>
<td>25.836431</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>448.0</td>
<td>Behavioral Health</td>
<td>Children'S Evaluation Services Unite</td>
<td>9990 County Farm Rd</td>
<td>Riverside</td>
<td>92503</td>
<td>951-358-7380</td>
<td>POINT (6195566.226 2280519.190)</td>
<td>1798</td>
<td>06065041201</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1135.0</td>
<td>25.836431</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>154.0</td>
<td>Behavioral Health</td>
<td>Van Horn Counseling Center</td>
<td>10000 County Farm Rd</td>
<td>Riverside</td>
<td>92503</td>
<td>951-358-4390</td>
<td>POINT (6195182.779 2280509.032)</td>
<td>1798</td>
<td>06065041201</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1135.0</td>
<td>25.836431</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>155.0</td>
<td>Behavioral Health</td>
<td>Inpatient Treatment Facility</td>
<td>9990 County Farm Rd</td>
<td>Riverside</td>
<td>92503</td>
<td>951-358-4700</td>
<td>POINT (6195566.226 2280519.190)</td>
<td>1798</td>
<td>06065041201</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1135.0</td>
<td>25.836431</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>156.0</td>
<td>Behavioral Health</td>
<td>Emergency Treatment Services</td>
<td>9990 County Farm Rd</td>
<td>Riverside</td>
<td>92503</td>
<td>951-358-4881</td>
<td>POINT (6195566.226 2280519.190)</td>
<td>1798</td>
<td>06065041201</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1135.0</td>
<td>25.836431</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>145.0</td>
<td>Behavioral Health</td>
<td>Adult Mental Health Services - West Clinic</td>
<td>9990 County Farm Rd</td>
<td>Riverside</td>
<td>92503</td>
<td>951-358-4647</td>
<td>POINT (6195566.226 2280520.460)</td>
<td>1798</td>
<td>06065041201</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1135.0</td>
<td>25.836431</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>151.0</td>
<td>Behavioral Health</td>
<td>Family, Adolescent, And Children'S Treatment</td>
<td>1195 Magnolia Ave</td>
<td>Corona</td>
<td>91719</td>
<td>951-273-0608</td>
<td>POINT (6168252.101 2261023.951)</td>
<td>517</td>
<td>06065041813</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>2084.0</td>
<td>28.686088</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>447.0</td>
<td>Behavioral Health</td>
<td>Blythe Clinic</td>
<td>1297 W Hobson Way</td>
<td>Blythe</td>
<td>92225</td>
<td>760-770-2222</td>
<td>POINT (7059944.605 2169652.046)</td>
<td>242</td>
<td>06065046102</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>887.0</td>
<td>14.184009</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>153.0</td>
<td>Behavioral Health</td>
<td>Children'S Interagency Program</td>
<td>23119 Cottonwood Ave</td>
<td>Moreno Valley</td>
<td>92553</td>
<td>951-413-5678</td>
<td>POINT (6255240.101 2281392.265)</td>
<td>1818</td>
<td>06065042512</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>968.0</td>
<td>9.930314</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>449.0</td>
<td>Behavioral Health</td>
<td>Substance Abuse Outpatient Program</td>
<td>623 N Main St</td>
<td>Corona</td>
<td>92880</td>
<td>951-737-2962</td>
<td>POINT (6162865.861 2269381.489)</td>
<td>1875</td>
<td>06065040809</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1026.0</td>
<td>29.670330</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>450.0</td>
<td>Behavioral Health</td>
<td>Substance Abuse Outpatient Program</td>
<td>650 N State St</td>
<td>Hemet</td>
<td>92543</td>
<td>951-791-3350</td>
<td>POINT (6342387.266 2220024.356)</td>
<td>1212</td>
<td>06065043507</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>2674.0</td>
<td>39.315175</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>137.0</td>
<td>Behavioral Health</td>
<td>Hemet Clinic</td>
<td>650 N State St</td>
<td>Hemet</td>
<td>92543</td>
<td>951-971-3300</td>
<td>POINT (6342390.651 2220029.434)</td>
<td>1212</td>
<td>06065043507</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>2674.0</td>
<td>39.315175</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>451.0</td>
<td>Behavioral Health</td>
<td>Substance Abuse Outpatient Program</td>
<td>83-912 Ave 45</td>
<td>Indio</td>
<td>92201</td>
<td>760-347-0754</td>
<td>POINT (6577094.185 2205388.907)</td>
<td>2466</td>
<td>06065045303</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>843.0</td>
<td>4.670699</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>452.0</td>
<td>Behavioral Health</td>
<td>Substance Abuse Outpatient Program</td>
<td>41002 County Center Dr</td>
<td>Temecula</td>
<td>92591</td>
<td>951-600-6360</td>
<td>POINT (6283871.161 2136729.378)</td>
<td>4266</td>
<td>06065049600</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>2443.0</td>
<td>58.274250</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>140.0</td>
<td>Behavioral Health</td>
<td>Temecula Clinic</td>
<td>41002 County Center Dr</td>
<td>Temecula</td>
<td>92590</td>
<td>951-600-6355</td>
<td>POINT (6283867.341 2136731.288)</td>
<td>4266</td>
<td>06065049600</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>2443.0</td>
<td>58.274250</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>157.0</td>
<td>Behavioral Health</td>
<td>Substance Abuse Outpatient Program</td>
<td>1827 Atlanta Ave</td>
<td>Riverside</td>
<td>92503</td>
<td>951-955-2105</td>
<td>POINT (6229918.194 2307140.803)</td>
<td>1546</td>
<td>06065042209</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1586.0</td>
<td>31.134793</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>147.0</td>
<td>Behavioral Health</td>
<td>Adult System Of Care</td>
<td>1827 Atlanta Ave</td>
<td>Riverside</td>
<td>92507</td>
<td>951-955-8000</td>
<td>POINT (6229918.194 2307139.534)</td>
<td>1546</td>
<td>06065042209</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1586.0</td>
<td>31.134793</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>148.0</td>
<td>Behavioral Health</td>
<td>Jefferson Wellness Center</td>
<td>1827 Atlanta Ave</td>
<td>Riverside</td>
<td>92507</td>
<td>951-955-8000</td>
<td>POINT (6229920.733 2307139.534)</td>
<td>1546</td>
<td>06065042209</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1586.0</td>
<td>31.134793</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>158.0</td>
<td>Behavioral Health</td>
<td>Substance Abuse Outpatient Program</td>
<td>68-615 Perez Rd</td>
<td>Cathedral City</td>
<td>92234</td>
<td>760-770-2222</td>
<td>POINT (6496477.603 2228753.546)</td>
<td>2453</td>
<td>06065045000</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1820.0</td>
<td>43.139842</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>142.0</td>
<td>Behavioral Health</td>
<td>Cathedral City Clinic</td>
<td>68-615 Perez Rd</td>
<td>Cathedral City</td>
<td>92234</td>
<td>760-770-2222</td>
<td>POINT (6496480.142 2228757.355)</td>
<td>2453</td>
<td>06065045000</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1820.0</td>
<td>43.139842</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>138.0</td>
<td>Behavioral Health</td>
<td>Perris Clinic</td>
<td>1688 N Perris Blvd</td>
<td>Perris</td>
<td>92570</td>
<td>951-443-2200</td>
<td>POINT (6265042.293 2237006.918)</td>
<td>4515</td>
<td>06065042620</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>2671.0</td>
<td>17.630000</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>139.0</td>
<td>Behavioral Health</td>
<td>San Jacinto Clinic</td>
<td>950 N Ramona Blvd</td>
<td>San Jacinto</td>
<td>92582</td>
<td>951-487-2674</td>
<td>POINT (6341877.001 2233915.961)</td>
<td>2955</td>
<td>06065051300</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>3064.0</td>
<td>45.269270</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>141.0</td>
<td>Behavioral Health</td>
<td>Banning Clinic</td>
<td>1330 W Ramsey St</td>
<td>Banning</td>
<td>92220</td>
<td>951-849-7142</td>
<td>POINT (6367147.411 2280861.442)</td>
<td>231</td>
<td>06065044101</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1223.0</td>
<td>35.014233</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>143.0</td>
<td>Behavioral Health</td>
<td>Indio Clinic</td>
<td>47-825 Oasis St</td>
<td>Indio</td>
<td>92201</td>
<td>760-863-8455</td>
<td>POINT (6570450.368 2198847.190)</td>
<td>2467</td>
<td>06065045501</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>1615.0</td>
<td>8.739635</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>144.0</td>
<td>Behavioral Health</td>
<td>Adult Mental Health Services - Blaine Clinic</td>
<td>769 Blaine St</td>
<td>Riverside</td>
<td>92507</td>
<td>951-358-4705</td>
<td>POINT (6234956.516 2303352.150)</td>
<td>172</td>
<td>06065042210</td>
<td>...</td>
<td>NaN</td>
<td>2010</td>
<td>2047.0</td>
<td>26.254459</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>28 rows × 202 columns</p>
</div>
</div>
</div>
</div>
<p>Now we see the spatial join has worked. There are 28 matches (one for each clinic) and this is stored in a new GeoDataFrame called: <code>clinics_tracts</code>.</p>
</section>
<section id="determine-the-number-of-clinics-in-each-tract" class="level2">
<h2 class="anchored" data-anchor-id="determine-the-number-of-clinics-in-each-tract">Determine the number of clinics in each tract</h2>
<p>Returning to our question, we can find the number of clinics in each of the tracts in this new GeoDataFrame by using the <code>group_by</code> method:</p>
<div id="cell-46" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>clinics_tracts[[<span class="st">'geoid'</span>, <span class="st">'index_right'</span>]].groupby(<span class="st">'geoid'</span>).agg(<span class="st">'count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">index_right</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">geoid</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">06065031100</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">06065040809</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">06065041201</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">06065041813</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">06065042209</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">06065042210</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">06065042512</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">06065042620</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">06065043507</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">06065044101</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">06065045000</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">06065045303</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">06065045501</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">06065046102</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">06065049600</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">06065051300</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<p>This works, so let’s create another DataFrame to store these counts:</p>
<div id="cell-48" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ct <span class="op">=</span> clinics_tracts[[<span class="st">'geoid'</span>, <span class="st">'index_right'</span>]].groupby(<span class="st">'geoid'</span>).agg(<span class="st">'count'</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>ct.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>(16, 1)</code></pre>
</div>
</div>
</section>
<section id="table-join" class="level2">
<h2 class="anchored" data-anchor-id="table-join">Table Join</h2>
<p>We now know for the tracts that contain at least one clinic, how many clinics they contain. This implies that the tracts that are not in the <code>ct</code> GeoDataFrame do not contain a clinic. What we would like to have is an additional attribute on our <code>rc</code> tracts GeoDataFrame that stores the number of clinics in each tract - for all tracts in Riverside County.</p>
<p>We can do this in two remaining steps:</p>
<ul>
<li>a table join on the <code>geoid</code> column</li>
<li>setting NA values to 0</li>
</ul>
<div id="cell-51" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>rc.merge(ct, on<span class="op">=</span><span class="st">'geoid'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geoid</th>
<th data-quarto-table-cell-role="th">n_asian_under_15</th>
<th data-quarto-table-cell-role="th">n_black_under_15</th>
<th data-quarto-table-cell-role="th">n_hispanic_under_15</th>
<th data-quarto-table-cell-role="th">n_native_under_15</th>
<th data-quarto-table-cell-role="th">n_white_under_15</th>
<th data-quarto-table-cell-role="th">n_persons_under_18</th>
<th data-quarto-table-cell-role="th">n_asian_over_60</th>
<th data-quarto-table-cell-role="th">n_black_over_60</th>
<th data-quarto-table-cell-role="th">n_hispanic_over_60</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">n_total_housing_units_sample</th>
<th data-quarto-table-cell-role="th">p_nonhisp_white_persons</th>
<th data-quarto-table-cell-role="th">p_white_over_60</th>
<th data-quarto-table-cell-role="th">p_black_over_60</th>
<th data-quarto-table-cell-role="th">p_hispanic_over_60</th>
<th data-quarto-table-cell-role="th">p_native_over_60</th>
<th data-quarto-table-cell-role="th">p_asian_over_60</th>
<th data-quarto-table-cell-role="th">p_disabled</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_right</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>06065042210</td>
<td>14.0</td>
<td>4.0</td>
<td>392.0</td>
<td>0.0</td>
<td>49.0</td>
<td>626.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2047.0</td>
<td>26.254459</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6231281.704 2304380.325, 6231334.275...</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>06065044101</td>
<td>0.0</td>
<td>0.0</td>
<td>441.0</td>
<td>0.0</td>
<td>90.0</td>
<td>643.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1223.0</td>
<td>35.014233</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6360916.988 2282317.240, 6368904.754...</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>06065046102</td>
<td>0.0</td>
<td>16.0</td>
<td>409.0</td>
<td>0.0</td>
<td>8.0</td>
<td>500.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>887.0</td>
<td>14.184009</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((7056901.702 2172059.918, 7059550.089...</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>06065041813</td>
<td>22.0</td>
<td>0.0</td>
<td>1385.0</td>
<td>0.0</td>
<td>218.0</td>
<td>2055.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2084.0</td>
<td>28.686088</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6163401.241 2262775.155, 6163930.681...</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>06065031100</td>
<td>0.0</td>
<td>35.0</td>
<td>686.0</td>
<td>0.0</td>
<td>322.0</td>
<td>1383.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1715.0</td>
<td>49.159311</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6212596.847 2292503.681, 6212608.840...</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>06065043507</td>
<td>13.0</td>
<td>56.0</td>
<td>1180.0</td>
<td>62.0</td>
<td>148.0</td>
<td>1806.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2674.0</td>
<td>39.315175</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6338337.356 2228280.689, 6339766.244...</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>06065042209</td>
<td>0.0</td>
<td>17.0</td>
<td>276.0</td>
<td>0.0</td>
<td>99.0</td>
<td>604.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1586.0</td>
<td>31.134793</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6227628.847 2309774.902, 6229897.721...</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>06065041201</td>
<td>66.0</td>
<td>14.0</td>
<td>704.0</td>
<td>0.0</td>
<td>94.0</td>
<td>1235.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1135.0</td>
<td>25.836431</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6191323.029 2284972.603, 6191482.639...</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>06065042512</td>
<td>115.0</td>
<td>220.0</td>
<td>674.0</td>
<td>0.0</td>
<td>56.0</td>
<td>1239.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>968.0</td>
<td>9.930314</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6254926.536 2282777.436, 6255161.965...</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>06065040809</td>
<td>92.0</td>
<td>79.0</td>
<td>328.0</td>
<td>12.0</td>
<td>129.0</td>
<td>952.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1026.0</td>
<td>29.670330</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6161525.232 2270923.411, 6162129.783...</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>06065045000</td>
<td>0.0</td>
<td>0.0</td>
<td>696.0</td>
<td>0.0</td>
<td>115.0</td>
<td>1013.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1820.0</td>
<td>43.139842</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6491233.939 2220786.970, 6491908.163...</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>06065045303</td>
<td>0.0</td>
<td>0.0</td>
<td>822.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1190.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>843.0</td>
<td>4.670699</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6566733.269 2209587.002, 6567651.882...</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>06065045501</td>
<td>0.0</td>
<td>12.0</td>
<td>1621.0</td>
<td>10.0</td>
<td>96.0</td>
<td>2097.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1615.0</td>
<td>8.739635</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6566573.447 2201041.319, 6566587.043...</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>06065051300</td>
<td>109.0</td>
<td>58.0</td>
<td>1348.0</td>
<td>164.0</td>
<td>635.0</td>
<td>2563.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>3064.0</td>
<td>45.269270</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6331082.861 2256322.304, 6333704.092...</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>06065049600</td>
<td>224.0</td>
<td>53.0</td>
<td>521.0</td>
<td>37.0</td>
<td>989.0</td>
<td>2182.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2443.0</td>
<td>58.274250</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6280386.943 2140389.101, 6280920.820...</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>06065042620</td>
<td>77.0</td>
<td>383.0</td>
<td>2143.0</td>
<td>43.0</td>
<td>237.0</td>
<td>3436.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2671.0</td>
<td>17.630000</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6254341.213 2261739.227, 6256667.021...</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>16 rows × 195 columns</p>
</div>
</div>
</div>
</div>
<p>Note that this isn’t quite what we want as it only matches the 16 tracts containing clinics. We can change the <code>how</code> argument to <code>outer</code> to include all tracts:</p>
<div id="cell-53" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>rc.merge(ct, on<span class="op">=</span><span class="st">'geoid'</span>, how<span class="op">=</span><span class="st">'outer'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geoid</th>
<th data-quarto-table-cell-role="th">n_asian_under_15</th>
<th data-quarto-table-cell-role="th">n_black_under_15</th>
<th data-quarto-table-cell-role="th">n_hispanic_under_15</th>
<th data-quarto-table-cell-role="th">n_native_under_15</th>
<th data-quarto-table-cell-role="th">n_white_under_15</th>
<th data-quarto-table-cell-role="th">n_persons_under_18</th>
<th data-quarto-table-cell-role="th">n_asian_over_60</th>
<th data-quarto-table-cell-role="th">n_black_over_60</th>
<th data-quarto-table-cell-role="th">n_hispanic_over_60</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">n_total_housing_units_sample</th>
<th data-quarto-table-cell-role="th">p_nonhisp_white_persons</th>
<th data-quarto-table-cell-role="th">p_white_over_60</th>
<th data-quarto-table-cell-role="th">p_black_over_60</th>
<th data-quarto-table-cell-role="th">p_hispanic_over_60</th>
<th data-quarto-table-cell-role="th">p_native_over_60</th>
<th data-quarto-table-cell-role="th">p_asian_over_60</th>
<th data-quarto-table-cell-role="th">p_disabled</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_right</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>06065042005</td>
<td>7.0</td>
<td>157.0</td>
<td>259.0</td>
<td>0.0</td>
<td>540.0</td>
<td>1472.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1511.0</td>
<td>52.240247</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6220451.886 2273544.863, 6222975.821...</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>06065042210</td>
<td>14.0</td>
<td>4.0</td>
<td>392.0</td>
<td>0.0</td>
<td>49.0</td>
<td>626.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2047.0</td>
<td>26.254459</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6231281.704 2304380.325, 6231334.275...</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>06065042403</td>
<td>10.0</td>
<td>62.0</td>
<td>604.0</td>
<td>0.0</td>
<td>142.0</td>
<td>1153.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1194.0</td>
<td>27.105703</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6265534.814 2293274.461, 6268193.946...</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>06065042405</td>
<td>17.0</td>
<td>570.0</td>
<td>877.0</td>
<td>0.0</td>
<td>140.0</td>
<td>1949.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1960.0</td>
<td>12.679643</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6254901.013 2289559.243, 6257552.324...</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>06065042507</td>
<td>6.0</td>
<td>196.0</td>
<td>1132.0</td>
<td>0.0</td>
<td>47.0</td>
<td>1778.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1209.0</td>
<td>11.965812</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6260074.881 2265634.857, 6260130.853...</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">448</td>
<td>06065040603</td>
<td>0.0</td>
<td>0.0</td>
<td>354.0</td>
<td>0.0</td>
<td>26.0</td>
<td>544.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>663.0</td>
<td>23.933856</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6170360.166 2300927.182, 6175629.477...</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">449</td>
<td>06065040701</td>
<td>17.0</td>
<td>0.0</td>
<td>142.0</td>
<td>0.0</td>
<td>332.0</td>
<td>669.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>694.0</td>
<td>78.002378</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6152825.515 2282403.524, 6153252.517...</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">450</td>
<td>06065042738</td>
<td>149.0</td>
<td>65.0</td>
<td>549.0</td>
<td>0.0</td>
<td>531.0</td>
<td>1709.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>2076.0</td>
<td>56.894592</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6281402.995 2194126.577, 6286714.535...</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">451</td>
<td>06065043309</td>
<td>0.0</td>
<td>59.0</td>
<td>493.0</td>
<td>6.0</td>
<td>204.0</td>
<td>855.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1165.0</td>
<td>44.564120</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6346253.508 2219037.609, 6347578.743...</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">452</td>
<td>06065044804</td>
<td>178.0</td>
<td>0.0</td>
<td>452.0</td>
<td>0.0</td>
<td>80.0</td>
<td>794.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>1162.0</td>
<td>27.977189</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>POLYGON ((6482476.986 2236646.419, 6482483.878...</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>453 rows × 195 columns</p>
</div>
</div>
</div>
</div>
<p>Ok now we have all the tracts covered. But if you scroll to the right we will see <code>NaN</code> values for the tracts that do not contain a clinic. What remains is to replace the</p>
<div id="cell-55" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>rc.merge(ct, on<span class="op">=</span><span class="st">'geoid'</span>, how<span class="op">=</span><span class="st">'outer'</span>).fillna(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">geoid</th>
<th data-quarto-table-cell-role="th">n_asian_under_15</th>
<th data-quarto-table-cell-role="th">n_black_under_15</th>
<th data-quarto-table-cell-role="th">n_hispanic_under_15</th>
<th data-quarto-table-cell-role="th">n_native_under_15</th>
<th data-quarto-table-cell-role="th">n_white_under_15</th>
<th data-quarto-table-cell-role="th">n_persons_under_18</th>
<th data-quarto-table-cell-role="th">n_asian_over_60</th>
<th data-quarto-table-cell-role="th">n_black_over_60</th>
<th data-quarto-table-cell-role="th">n_hispanic_over_60</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">n_total_housing_units_sample</th>
<th data-quarto-table-cell-role="th">p_nonhisp_white_persons</th>
<th data-quarto-table-cell-role="th">p_white_over_60</th>
<th data-quarto-table-cell-role="th">p_black_over_60</th>
<th data-quarto-table-cell-role="th">p_hispanic_over_60</th>
<th data-quarto-table-cell-role="th">p_native_over_60</th>
<th data-quarto-table-cell-role="th">p_asian_over_60</th>
<th data-quarto-table-cell-role="th">p_disabled</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">index_right</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>06065042005</td>
<td>7.0</td>
<td>157.0</td>
<td>259.0</td>
<td>0.0</td>
<td>540.0</td>
<td>1472.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>1511.0</td>
<td>52.240247</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>POLYGON ((6220451.886 2273544.863, 6222975.821...</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>06065042210</td>
<td>14.0</td>
<td>4.0</td>
<td>392.0</td>
<td>0.0</td>
<td>49.0</td>
<td>626.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>2047.0</td>
<td>26.254459</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>POLYGON ((6231281.704 2304380.325, 6231334.275...</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>06065042403</td>
<td>10.0</td>
<td>62.0</td>
<td>604.0</td>
<td>0.0</td>
<td>142.0</td>
<td>1153.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>1194.0</td>
<td>27.105703</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>POLYGON ((6265534.814 2293274.461, 6268193.946...</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>06065042405</td>
<td>17.0</td>
<td>570.0</td>
<td>877.0</td>
<td>0.0</td>
<td>140.0</td>
<td>1949.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>1960.0</td>
<td>12.679643</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>POLYGON ((6254901.013 2289559.243, 6257552.324...</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>06065042507</td>
<td>6.0</td>
<td>196.0</td>
<td>1132.0</td>
<td>0.0</td>
<td>47.0</td>
<td>1778.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>1209.0</td>
<td>11.965812</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>POLYGON ((6260074.881 2265634.857, 6260130.853...</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">448</td>
<td>06065040603</td>
<td>0.0</td>
<td>0.0</td>
<td>354.0</td>
<td>0.0</td>
<td>26.0</td>
<td>544.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>663.0</td>
<td>23.933856</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>POLYGON ((6170360.166 2300927.182, 6175629.477...</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">449</td>
<td>06065040701</td>
<td>17.0</td>
<td>0.0</td>
<td>142.0</td>
<td>0.0</td>
<td>332.0</td>
<td>669.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>694.0</td>
<td>78.002378</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>POLYGON ((6152825.515 2282403.524, 6153252.517...</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">450</td>
<td>06065042738</td>
<td>149.0</td>
<td>65.0</td>
<td>549.0</td>
<td>0.0</td>
<td>531.0</td>
<td>1709.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>2076.0</td>
<td>56.894592</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>POLYGON ((6281402.995 2194126.577, 6286714.535...</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">451</td>
<td>06065043309</td>
<td>0.0</td>
<td>59.0</td>
<td>493.0</td>
<td>6.0</td>
<td>204.0</td>
<td>855.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>1165.0</td>
<td>44.564120</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>POLYGON ((6346253.508 2219037.609, 6347578.743...</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">452</td>
<td>06065044804</td>
<td>178.0</td>
<td>0.0</td>
<td>452.0</td>
<td>0.0</td>
<td>80.0</td>
<td>794.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>1162.0</td>
<td>27.977189</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>POLYGON ((6482476.986 2236646.419, 6482483.878...</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>453 rows × 195 columns</p>
</div>
</div>
</div>
</div>
<p>Great. Now we save our work and rename the column holding the clinic count:</p>
<div id="cell-57" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>rc <span class="op">=</span> rc.merge(ct, on<span class="op">=</span><span class="st">'geoid'</span>, how<span class="op">=</span><span class="st">'outer'</span>).fillna(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-58" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>rc[<span class="st">'index_right'</span>].<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>28.0</code></pre>
</div>
</div>
<div id="cell-59" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>rc.rename(columns<span class="op">=</span>{<span class="st">'index_right'</span>: <span class="st">'clinics'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-60" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>rc.clinics.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>28.0</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(rc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>geopandas.geodataframe.GeoDataFrame</code></pre>
</div>
</div>
<div class="alert alert-success" style="font-size:120%">
<p><b>Exercise</b>: <br> Create a shapefile for each of the counties in the Southern California dataframe, and write to <code>data/FIPSCODE.shp</code>. Where <code>FIPSCODE</code> is the 5-digit <a href="https://www.nrcs.usda.gov/wps/portal/nrcs/detail/ca/home/?cid=nrcs143_013697">FIPS Code for the county</a>.</p>
</div>
<div id="cell-63" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %load solutions/00.py</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a rel="license" href="http://creativecommons.org/licenses/by-nc-
sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a><br><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Geoprocessing</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://sergerey.org" property="cc:attributionName" rel="cc:attributionURL">Serge Rey</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../week-04/0208_choropleths.html" class="pagination-link" aria-label="Geovisualization with PySAL II">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Geovisualization with PySAL II</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../week-06/inequality.html" class="pagination-link" aria-label="Regional Inequality">
        <span class="nav-page-text">Regional Inequality</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Course material by <a href="https://sergerey.org">Sergio Rey</a>. Available under <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/sjsrey/g584s24/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>